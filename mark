import pandas as pd
import os
import glob

def process_excel_file(file_path):
    # Read the first sheet of the Excel file, limiting to the first 14 columns
    df = pd.read_excel(file_path, sheet_name=0, usecols=range(14))
    
    # Initialize a list to store the results
    results = []
    
    # Iterate over the rows to find the 'Annual' rows and corresponding grades
    for index, row in df.iterrows():
        if row[1] == 'Annual':
            grade = df.iloc[index - 2, 0]  # Assuming the grade is two rows above the 'Annual' row
            min_rate = row[2]  # 1st Step
            max_rate = row.iloc[-1]  # Last Step within the first 14 columns
            
            # Append the result to the list
            results.append({
                'Grade': grade,
                'Min_rate': min_rate,
                'Max_rate': max_rate,
                'Category': os.path.basename(file_path)
            })
    
    return results

# Directory containing the Excel files
directory = 'path_to_your_directory'

# List to store all results
all_results = []

# Iterate over all Excel files in the directory
for file_path in glob.glob(os.path.join(directory, '*.xlsx')):
    all_results.extend(process_excel_file(file_path))

# Create a DataFrame from the collected results
result_df = pd.DataFrame(all_results)

# Display or save the DataFrame
print(result_df)
# result_df.to_csv('output.csv', index=False)  # Uncomment to save the DataFrame to a CSV file
